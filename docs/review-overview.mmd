%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4f46e5', 'primaryTextColor': '#fff'}}}%%

flowchart TB
    subgraph Input["è¾“å…¥"]
        A["review /repo feature main"]
    end

    subgraph Phase1["Phase 1: ä¸Šä¸‹æ–‡æ„å»º"]
        direction LR
        B1["Git Diff<br/>ä¸‰ç‚¹å¼æ¯”è¾ƒ"] --> B2["è§£æ Diff"] --> B3["æœ¬åœ°åˆ†æ"] --> B4["æå–æ ‡å‡†"]
    end

    subgraph Selection["Agent é€‰æ‹©"]
        C["æ™ºèƒ½è·¯ç”±<br/>è§„åˆ™ + LLM å…œåº•"]
    end

    subgraph Phase2["Phase 2: Agent æ‰§è¡Œ"]
        direction LR
        D1["ğŸ”’ Security"]
        D2["ğŸ§  Logic"]
        D3["âš¡ Performance"]
        D4["âœ¨ Style"]
    end

    subgraph Optimization["ä¼˜åŒ–å¤„ç†"]
        direction LR
        E1["å»é‡<br/>Nâ†’M"] --> E2["ç½®ä¿¡åº¦è¿‡æ»¤<br/>åŠ¨æ€é˜ˆå€¼"]
    end

    subgraph Phase3["Phase 3: éªŒè¯"]
        F["æŒ‘æˆ˜æ¨¡å¼<br/>å¤šè½®éªŒè¯"]
    end

    subgraph Phase4["Phase 4: è¾“å‡º"]
        direction LR
        G1["èšåˆæ’åº"] --> G2["ç”ŸæˆæŠ¥å‘Š"]
    end

    subgraph Output["è¾“å‡ºæ ¼å¼"]
        direction LR
        H1["Markdown"]
        H2["JSON"]
        H3["Summary"]
        H4["PR Comments"]
    end

    A --> Phase1
    Phase1 --> C
    C --> D1 & D2 & D3 & D4
    D1 & D2 & D3 & D4 --> Optimization
    Optimization --> F
    F --> Phase4
    G2 --> H1 & H2 & H3 & H4

    style Phase1 fill:#4f46e5,color:#fff
    style Phase2 fill:#3b82f6,color:#fff
    style Phase3 fill:#8b5cf6,color:#fff
    style Phase4 fill:#22c55e,color:#fff
