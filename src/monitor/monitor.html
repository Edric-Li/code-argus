<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Review Monitor - Argus</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .status-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .current-phase {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .phase-title {
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .phase-message {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .progress-section {
            margin-top: 20px;
        }

        .progress-bar-container {
            background: rgba(255,255,255,0.3);
            border-radius: 20px;
            height: 30px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-bar {
            background: white;
            height: 100%;
            border-radius: 20px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #764ba2;
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .agent-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .agent-card:hover {
            transform: translateY(-2px);
        }

        .agent-card.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .agent-card.completed {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }

        .agent-name {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .agent-status {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .timeline {
            margin-top: 30px;
        }

        .timeline-item {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .timeline-marker {
            width: 12px;
            height: 12px;
            background: #667eea;
            border-radius: 50%;
            margin-top: 6px;
            flex-shrink: 0;
        }

        .timeline-marker.phase {
            background: #f5576c;
            width: 16px;
            height: 16px;
        }

        .timeline-marker.complete {
            background: #84fab0;
        }

        .timeline-marker.error {
            background: #ff6b6b;
        }

        .timeline-content {
            flex: 1;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .timeline-time {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .timeline-message {
            font-size: 1em;
            color: #333;
            font-weight: 500;
        }

        .timeline-details {
            margin-top: 8px;
            font-size: 0.9em;
            color: #666;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #84fab0;
            animation: pulse 2s infinite;
        }

        .status-dot.disconnected {
            background: #ff6b6b;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Argus Code Review Monitor</h1>
            <p class="subtitle">ÂÆûÊó∂‰ª£Á†ÅÂÆ°Êü•Áä∂ÊÄÅÁõëÊéß</p>
        </header>

        <div class="connection-status">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">ËøûÊé•‰∏≠...</span>
        </div>

        <div class="status-card">
            <div class="current-phase" id="currentPhase">
                <div class="phase-title">ÂàùÂßãÂåñ‰∏≠...</div>
                <div class="phase-message">Ê≠£Âú®Âª∫Á´ãËøûÊé•</div>
                <div class="progress-section" id="progressSection" style="display: none;">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
                    </div>
                </div>
            </div>

            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-value" id="statPhases">-</div>
                    <div class="stat-label">ÂΩìÂâçÈò∂ÊÆµ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statAgents">0</div>
                    <div class="stat-label">ËøêË°åÁöÑ Agents</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statIssues">-</div>
                    <div class="stat-label">ÂèëÁé∞ÁöÑÈóÆÈ¢ò</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statTime">0s</div>
                    <div class="stat-label">Â∑≤Áî®Êó∂Èó¥</div>
                </div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #333;">Specialist Agents</h3>
            <div class="agents-grid" id="agentsGrid"></div>
        </div>

        <div class="status-card">
            <h3 style="margin-bottom: 20px; color: #333;">ÊâßË°åÊó•Âøó</h3>
            <div class="timeline" id="timeline"></div>
        </div>
    </div>

    <script>
        let ws;
        let startTime = Date.now();
        let agents = new Map();

        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const currentPhase = document.getElementById('currentPhase');
        const progressSection = document.getElementById('progressSection');
        const progressBar = document.getElementById('progressBar');
        const timeline = document.getElementById('timeline');
        const agentsGrid = document.getElementById('agentsGrid');

        const statPhases = document.getElementById('statPhases');
        const statAgents = document.getElementById('statAgents');
        const statIssues = document.getElementById('statIssues');
        const statTime = document.getElementById('statTime');

        function connect() {
            const wsUrl = `ws://${window.location.host}`;
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                statusDot.classList.remove('disconnected');
                statusText.textContent = 'Â∑≤ËøûÊé•';
                console.log('WebSocket connected');
            };

            ws.onclose = () => {
                statusDot.classList.add('disconnected');
                statusText.textContent = 'ËøûÊé•Êñ≠ÂºÄ';
                console.log('WebSocket disconnected');
                setTimeout(connect, 3000);
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);

                if (data.type === 'history') {
                    // Load history
                    data.data.forEach(update => handleUpdate(update));
                } else {
                    handleUpdate(data);
                }
            };
        }

        function handleUpdate(update) {
            switch (update.type) {
                case 'phase':
                    handlePhase(update);
                    break;
                case 'agent':
                    handleAgent(update);
                    break;
                case 'progress':
                    handleProgress(update);
                    break;
                case 'complete':
                    handleComplete(update);
                    break;
                case 'error':
                    handleError(update);
                    break;
            }

            addTimelineItem(update);
        }

        function handlePhase(update) {
            currentPhase.querySelector('.phase-title').innerHTML =
                `<span class="spinner"></span> ${update.phase || update.message}`;
            currentPhase.querySelector('.phase-message').textContent = update.message;
            statPhases.textContent = update.phase || '-';
        }

        function handleAgent(update) {
            if (!agents.has(update.agent)) {
                agents.set(update.agent, {
                    name: update.agent,
                    status: 'pending'
                });
            }

            const agent = agents.get(update.agent);
            agent.status = update.details?.status || 'running';
            agent.message = update.message;

            updateAgentsGrid();
            statAgents.textContent = Array.from(agents.values())
                .filter(a => a.status === 'running').length;
        }

        function handleProgress(update) {
            if (update.progress !== undefined && update.total !== undefined) {
                progressSection.style.display = 'block';
                const percent = Math.round((update.progress / update.total) * 100);
                progressBar.style.width = percent + '%';
                progressBar.textContent = `${update.progress}/${update.total} (${percent}%)`;
            }
        }

        function handleComplete(update) {
            currentPhase.querySelector('.phase-title').textContent = '‚úÖ ÂÆ°Êü•ÂÆåÊàê';
            currentPhase.querySelector('.phase-message').textContent = update.message;
            currentPhase.style.background = 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)';

            if (update.details?.issues) {
                statIssues.textContent = update.details.issues;
            }
        }

        function handleError(update) {
            currentPhase.querySelector('.phase-title').textContent = '‚ùå ÂèëÁîüÈîôËØØ';
            currentPhase.querySelector('.phase-message').textContent = update.message;
            currentPhase.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%)';
        }

        function updateAgentsGrid() {
            agentsGrid.innerHTML = '';
            agents.forEach(agent => {
                const card = document.createElement('div');
                card.className = `agent-card ${agent.status}`;

                let statusIcon = '‚è≥';
                if (agent.status === 'running') statusIcon = 'üîÑ';
                if (agent.status === 'completed') statusIcon = '‚úÖ';
                if (agent.status === 'error') statusIcon = '‚ùå';

                card.innerHTML = `
                    <div class="agent-name">${statusIcon} ${agent.name}</div>
                    <div class="agent-status">${agent.message || agent.status}</div>
                `;
                agentsGrid.appendChild(card);
            });
        }

        function addTimelineItem(update) {
            const item = document.createElement('div');
            item.className = 'timeline-item';

            const markerClass = update.type === 'phase' ? 'phase' :
                               update.type === 'complete' ? 'complete' :
                               update.type === 'error' ? 'error' : '';

            const time = new Date(update.timestamp).toLocaleTimeString('zh-CN');

            let details = '';
            if (update.details) {
                details = `<div class="timeline-details">${JSON.stringify(update.details, null, 2)}</div>`;
            }

            item.innerHTML = `
                <div class="timeline-marker ${markerClass}"></div>
                <div class="timeline-content">
                    <div class="timeline-time">${time}</div>
                    <div class="timeline-message">${update.message}</div>
                    ${details}
                </div>
            `;

            timeline.insertBefore(item, timeline.firstChild);

            // Keep only last 50 items
            while (timeline.children.length > 50) {
                timeline.removeChild(timeline.lastChild);
            }
        }

        // Update timer
        setInterval(() => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            statTime.textContent = elapsed + 's';
        }, 1000);

        // Connect on load
        connect();
    </script>
</body>
</html>
